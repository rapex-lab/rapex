(self.webpackChunkrapex_studio=self.webpackChunkrapex_studio||[]).push([[344],{54030:function(Vt,Ze,t){"use strict";t.r(Ze),t.d(Ze,{default:function(){return wt},makeQueryStr:function(){return fe}});var $t=t(13062),Se=t(71230),Qt=t(89032),je=t(15746),Ut=t(66456),Ce=t(15885),C=t(8870),Yt=t(98858),Y=t(4914),Jt=t(18106),Ee=t(38222),J=t(86582),Xt=t(34792),W=t(48086),kt=t(71153),X=t(60331),m=t(2824),u=t(67294),qt=t(57338),Fe=t(273),e=t(85893),Ae=function(n){var r=n.position,a=n.onClick,o=(0,u.useState)(!1),c=(0,m.Z)(o,2),l=c[0],i=c[1],p=function(){i(!l)},f={right:{right:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent #ddd transparent transparent"},top:{top:"0px",left:"45%",width:"80px",height:"38px",borderColor:"#ddd transparent transparent transparent"},left:{left:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent transparent transparent #ddd"},bottom:{left:"45%",bottom:"0px",width:"80px",height:"38px",borderColor:"transparent transparent #ddd transparent"}},y={right:{left:"5px",top:"8px"},top:{top:"-20px",left:"40%"},bottom:{left:"15px",top:"0px"},left:{left:"-15px",top:"8px"}},h=r||"right",D=f[h]?f[h]:f.right,T=y[h]?y[h]:y.right;return(0,e.jsxs)("div",{className:"toolbar",children:[(0,e.jsx)("div",{style:(0,C.Z)({zIndex:10,position:"absolute",cursor:"pointer",borderStyle:"solid",borderWidth:"20px"},D),onClick:function(){console.log("Show Drawer: ",h),p(),a&&a(h)},children:(0,e.jsx)("span",{style:(0,C.Z)({position:"absolute"},T),children:h==="top"||h==="bottom"?"=":"||"})}),(0,e.jsx)(Fe.Z,{width:"300px",height:"300px",title:!1,getContainer:!1,style:{position:"absolute"},closable:!1,mask:!1,placement:r,onClose:p,visible:l,children:n.children})]})},be=Ae,k=t(96486),Ke=t(42134),oe=t(82735),H=t(98818),re=t(36950),le=t(4714),We=t(49346),He=t(62876),Be=t(93695),ze=t(95357),Ve=t(73171),$e=t(73218),Qe=t(19671),Ue=t(66485),Ne=t.n(Ue),Te=function(n,r){var a=[];n.map(function(i){a=a.concat(Object.keys(i))});var o=[],c=(0,k.uniq)(a),l=(0,k.filter)(c,function(i){return r.indexOf(i)<0});return l.map(function(i){o.push({title:Ne().titleCase(i),key:i,dataIndex:i,align:"center",ellipsis:!0})}),o},Oe=function(n){return n.map(function(r){return Ge(r)})},se=function(n,r){var a={},o=Object.keys(n),c=(0,k.filter)(o,function(l){return r?r.indexOf(l)<0:!0});return c.forEach(function(l){["string","number","boolean"].indexOf(typeof n[l])>=0&&(a[l]=n[l])}),a},Ge=function(n,r){return n.data?(0,C.Z)((0,C.Z)({},se(n,r)),se(n.data,r)):se(n)},Ye=oe.Z.MiniMap,Je=oe.Z.SnapLine,De=oe.Z.Tooltip,Xe=H.Z.ZoomCanvas,ke=H.Z.ActivateRelations,qe=H.Z.ClickSelect,_e=H.Z.Hoverable,et=H.Z.FitView,tt=H.Z.DragNodeWithForce,B=le.Z.Menu,nt={line:{stroke:"lightgreen",lineWidth:1}},at=function(n){var r=u.useContext(re.Z),a=r.graph,o=r.apis,c=[{key:"expand",icon:(0,e.jsx)(He.Z,{}),name:"Expand One Level"},{key:"delete",icon:(0,e.jsx)(Be.Z,{}),name:"Delete Node"}],l=function(p,f){n.onChange&&a&&o?n.onChange(p,f,a,o):W.ZP.warn("Cannot catch the changes.")};return(0,e.jsx)(B,{options:c,onChange:l,bindType:"node"})},ot=function(n){var r=u.useContext(re.Z),a=r.graph,o=r.contextmenu,c=o.canvas,l=function(){a.downloadFullImage("canvas-contextmenu"),c.handleClose()},i=function(){W.ZP.info("Clear canvas successfully"),c.handleClose()},p=function(){W.ZP.info("Stop layout successfully"),c.handleClose()},f=function(){n.handleOpenFishEye()};return(0,e.jsxs)(B,{bindType:"canvas",children:[(0,e.jsxs)(B.Item,{onClick:f,children:[(0,e.jsx)(ze.Z,{})," Enable FishEye"]}),(0,e.jsxs)(B.Item,{onClick:i,children:[(0,e.jsx)(Ve.Z,{})," Clear Canvas"]}),(0,e.jsxs)(B.Item,{onClick:p,children:[(0,e.jsx)($e.Z,{})," Stop Layout"]}),(0,e.jsxs)(B.Item,{onClick:l,children:[(0,e.jsx)(Qe.Z,{})," Download Layout"]})]})},rt=function(n){if(n.selectedNode){var r=u.useContext(re.Z),a=r.graph,o=a.getNodes(),c=a.getEdges();o.forEach(function(l){a.setItemState(l,"inactive",!1),a.setItemState(l,"active",!1)}),o.forEach(function(l){var i=l.getModel();n.selectedNode&&n.selectedNode!==i.id?(console.log("UnSelected Node: ",n.selectedNode,i.id),a.setItemState(l,"inactive",!0)):(console.log("Selected Node: ",n.selectedNode,i.id),a.setItemState(l,"active",!0))})}return null},lt=function(n){var r=n.data,a=n.layout,o=n.style,c=n.handleChange,l=n.config,i=n.selectedNode,p=(0,u.useState)(!1),f=(0,m.Z)(p,2),y=f[0],h=f[1],D=function(){h(!0)},T=function(){h(!1)},E=function(v){var j=v.data,P=v.style;console.log("HoverText: ",j);var O=Ge(j,["comboId","degree","depth","layoutOrder","x","y","type","category"]),G=Object.keys(O).map(function(A){return O[A]?(0,e.jsx)(Y.Z.Item,{label:Ne().titleCase(A),children:O[A]},A):null});return G.length>0?(0,e.jsx)(Y.Z,{size:"small",column:1,title:null,bordered:!0,style:P,children:G}):(0,e.jsx)("span",{style:P,children:"No Properties"})};return r&&(0,e.jsxs)(Ke.ZP,{fitCenter:!0,data:r,layout:a,style:o,children:[(0,e.jsx)(et,{}),(0,e.jsx)(tt,{autoPin:!0}),(0,e.jsx)(rt,{selectedNode:i}),(0,e.jsx)(Xe,{}),(0,e.jsx)(We.Z,{options:{},visible:y,handleEscListener:T}),(0,e.jsx)(qe,{multiple:!0,trigger:"shift"}),(l?l.nodeTooltipEnabled:null)?(0,e.jsx)(De,{bindType:"node",hasArrow:!0,children:function(v){if(v.model){var j=v.model;return(0,e.jsx)(E,{data:j,style:{padding:"10px",minWidth:"300px",maxWidth:"500px"}})}return null}}):null,(l?l.edgeTooltipEnabled:null)?(0,e.jsx)(De,{bindType:"edge",hasArrow:!0,children:function(v){if(v.model){var j=v.model;return(0,e.jsx)(E,{data:j,style:{padding:"10px",width:"fit-content"}})}return null}}):null,(l?l.miniMapEnabled:null)?(0,e.jsx)(Ye,{}):null,(0,e.jsx)(_e,{bindType:"node"}),(l?l.snapLineEnabled:null)?(0,e.jsx)(Je,{options:nt,visible:!0}):null,(0,e.jsx)(ke,{}),(0,e.jsx)(le.Z,{style:{width:"150px"},children:(0,e.jsx)(at,{onChange:c})}),(0,e.jsx)(le.Z,{style:{width:"150px"},bindType:"canvas",children:(0,e.jsx)(ot,{handleOpenFishEye:D})})]})},st=lt,_t=t(49111),it=t(19650),en=t(77576),V=t(12028),tn=t(22385),dt=t(94199),nn=t(57663),ct=t(71577),an=t(9715),I=t(55843),on=t(43358),q=t(34041),rn=t(7359),Pe=t(27279),ut=t(24616),ht=t(48965),vt=t(16360),ft=t(33182),pt=t(24557),gt=t(82738),xt=t(28052),yt=t(71938),mt=t(39588),Zt=t(25782),St=t(75768),jt=Pe.Z.Panel,Ct=q.Z.Option,Et=function(n){var r=n.style,a=n.onChangeConfig,o=n.config,c=I.Z.useForm(),l=(0,m.Z)(c,1),i=l[0],p=(0,u.useState)(!1),f=(0,m.Z)(p,2),y=f[0],h=f[1],D={"graphin-force":(0,e.jsx)(ht.Z,{}),random:(0,e.jsx)(vt.Z,{}),concentric:(0,e.jsx)(ft.Z,{}),circle:(0,e.jsx)(pt.Z,{}),force:(0,e.jsx)(gt.Z,{}),dagre:(0,e.jsx)(xt.Z,{}),grid:(0,e.jsx)(yt.Z,{}),radial:(0,e.jsx)(mt.Z,{})},T=[{type:"graphin-force",workerEnabled:!0,gpuEnabled:!0}];return(0,e.jsxs)(it.Z,{style:(0,C.Z)({},r),children:[(0,e.jsx)(dt.Z,{title:"Knowledge Graph Configuration",children:(0,e.jsx)(ct.Z,{onClick:function(){return h(!y)},className:"hover-button",type:"ghost",shape:"circle",icon:(0,e.jsx)(ut.Z,{})})}),y?(0,e.jsx)(je.Z,{className:"hover-menu",children:(0,e.jsx)(Pe.Z,{defaultActiveKey:["canvas"],expandIcon:function(Z){var v=Z.isActive;return(0,e.jsx)(Zt.Z,{rotate:v?90:0})},children:(0,e.jsx)(jt,{header:"Canvas",children:(0,e.jsxs)(I.Z,{labelCol:{span:9},layout:"horizontal",form:i,initialValues:o,onValuesChange:function(Z,v){var j={miniMapEnabled:v.miniMapEnabled,snapLineEnabled:v.snapLineEnabled,nodeTooltipEnabled:v.nodeTooltipEnabled,edgeTooltipEnabled:v.edgeTooltipEnabled,infoPanelEnabled:v.infoPanelEnabled},P=T.find(function(O){return O.type===v.layout});a(j,P)},children:[(0,e.jsx)(I.Z.Item,{label:"Layout",name:"layout",children:(0,e.jsx)(q.Z,{style:{width:"100%"},allowClear:!0,placeholder:"Select a layout",children:T.map(function(E){var Z=E.type,v=D[Z]||(0,e.jsx)(St.Z,{});return(0,e.jsxs)(Ct,{value:Z,children:[v," \xA0",Z]},Z)})})}),(0,e.jsx)(I.Z.Item,{label:"MiniMap",name:"miniMapEnabled",valuePropName:"checked",children:(0,e.jsx)(V.Z,{})}),(0,e.jsx)(I.Z.Item,{label:"SnapLine",name:"snapLineEnabled",valuePropName:"checked",children:(0,e.jsx)(V.Z,{})}),(0,e.jsx)(I.Z.Item,{label:"Node Tooltip",name:"nodeTooltipEnabled",valuePropName:"checked",children:(0,e.jsx)(V.Z,{})}),(0,e.jsx)(I.Z.Item,{label:"Edge Tooltip",name:"edgeTooltipEnabled",valuePropName:"checked",children:(0,e.jsx)(V.Z,{})}),(0,e.jsx)(I.Z.Item,{label:"Info Panel",name:"infoPanelEnabled",valuePropName:"checked",children:(0,e.jsx)(V.Z,{})})]})},"canvas")})}):null]})},bt=Et,ln=t(13254),Nt=t(14277),F=t(39428),_=t(3182),ie=t(74310);function Tt(s,n){return de.apply(this,arguments)}function de(){return de=(0,_.Z)((0,F.Z)().mark(function s(n,r){return(0,F.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,ie.WY)("/api/v1/labels",(0,C.Z)({method:"GET",params:(0,C.Z)({},n)},r||{})));case 1:case"end":return o.stop()}},s)})),de.apply(this,arguments)}function sn(s,n){return ce.apply(this,arguments)}function ce(){return ce=_asyncToGenerator(_regeneratorRuntime().mark(function s(n,r){return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",request("/api/v1/node-properties",_objectSpread({method:"GET",params:_objectSpread({},n)},r||{})));case 1:case"end":return o.stop()}},s)})),ce.apply(this,arguments)}function Ot(s){return ue.apply(this,arguments)}function ue(){return ue=(0,_.Z)((0,F.Z)().mark(function s(n){return(0,F.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,ie.WY)("/api/v1/node-types",(0,C.Z)({method:"GET"},n||{})));case 1:case"end":return a.stop()}},s)})),ue.apply(this,arguments)}function Le(s,n){return he.apply(this,arguments)}function he(){return he=(0,_.Z)((0,F.Z)().mark(function s(n,r){return(0,F.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,ie.WY)("/api/v1/nodes",(0,C.Z)({method:"GET",params:(0,C.Z)({},n)},r||{})));case 1:case"end":return o.stop()}},s)})),he.apply(this,arguments)}function dn(s){return ve.apply(this,arguments)}function ve(){return ve=_asyncToGenerator(_regeneratorRuntime().mark(function s(n){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/api/v1/relationship-types",_objectSpread({method:"GET"},n||{})));case 1:case"end":return a.stop()}},s)})),ve.apply(this,arguments)}var ee;function Gt(s,n,r){console.log("makeQueryStr filter: ",r);var a=":select [:*]",o="",c="";if(n){var l=Object.keys(n)[0],i=Object.values(n)[0];l&&i&&(i==="ascend"?o=":order-by [:".concat(l,"]"):o=":order-by [[:".concat(l," :desc]]"))}if(s){for(var p=[],f=0,y=Object.keys(s);f<y.length;f++){var h=y[f];["current","pageSize"].indexOf(h)<0&&s[h].length>0&&p.push("[:like [:upper :".concat(h,'] [:upper "%').concat(s[h],'%"]]'))}p.length==1?c=":where ".concat(p[0]):p.length>1&&(c=":where [:or ".concat(p.join(" "),"]"))}return"{".concat(a," ").concat(o," ").concat(c,"}")}var Dt=function(n){var r=(0,u.useState)([]),a=(0,m.Z)(r,2),o=a[0],c=a[1],l=(0,u.useState)(!1),i=(0,m.Z)(l,2),p=i[0],f=i[1],y=(0,u.useState)("Search Gene nodes ..."),h=(0,m.Z)(y,2),D=h[0],T=h[1],E=(0,u.useState)(void 0),Z=(0,m.Z)(E,2),v=Z[0],j=Z[1],P=(0,u.useState)("Gene"),O=(0,m.Z)(P,2),G=O[0],A=O[1],te=function(){var b=(0,_.Z)((0,F.Z)().mark(function S(N,L){var $;return(0,F.Z)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:ee&&(clearTimeout(ee),ee=null),$=function(){f(!0),Tt({query_str:Gt({id:L,name:L},{},{}),label_type:N}).then(function(z){var ye=z.data,ne=ye.map(function(M){return{value:M.id,text:"".concat(M.id," | ").concat(M.name)}});console.log("getLabels results: ",ne);var me=ne.map(function(M){return{label:M.text,value:M.value}});f(!1),j(me)}).catch(function(z){console.log("requestDEGs Error: ",z),j([]),f(!1)})},ee=setTimeout($,300);case 3:case"end":return Q.stop()}},S)}));return function(N,L){return b.apply(this,arguments)}}(),pe=function(S){A(S),j(void 0),T("Search ".concat(S," nodes ..."))},ge=function(S){S?te(G,S):j(void 0)},xe=function(S){if(console.log("Handle Change: ",S),S){var N;(N=n.onChange)===null||N===void 0||N.call(n,G,S)}else{var L;(L=n.onChange)===null||L===void 0||L.call(n,G,void 0)}};return(0,u.useEffect)(function(){Ot().then(function(b){console.log("Get types of nodes: ",b);var S=[];b.node_types?(b.node_types.forEach(function(N){S.push({label:N,value:N})}),c(S)):c([])})},[]),(0,e.jsxs)(Se.Z,{className:"query-builder",children:[(0,e.jsx)(q.Z,{value:G,style:{width:"auto",minWidth:"100px"},options:o,onSelect:pe}),(0,e.jsx)(q.Z,{showSearch:!0,allowClear:!0,loading:p,defaultActiveFirstOption:!1,showArrow:!0,placeholder:D,onSearch:ge,onChange:xe,options:v,filterOption:!1,notFoundContent:(0,e.jsx)(Nt.Z,{description:p?"Searching...":v!==void 0?"Not Found":"Enter your interested ".concat(G," ...")})})]})},Pt=Dt,Lt={type:"graphin-force",minNodeSpacing:20,getId:function(n){return n.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 50}},Mt={backgroundImage:"url(".concat(window.publicPath+"graph-background.png",")")};function fe(s,n){return'{:match "'.concat(s,'" :where "').concat(n,'" :limit 100 :return "n, r, m"}')}var Rt=function(){var n=(0,u.useState)({nodes:[],edges:[]}),r=(0,m.Z)(n,2),a=r[0],o=r[1],c=(0,u.useState)([]),l=(0,m.Z)(c,2),i=l[0],p=l[1],f=(0,u.useState)([]),y=(0,m.Z)(f,2),h=y[0],D=y[1],T=(0,u.useState)([]),E=(0,m.Z)(T,2),Z=E[0],v=E[1],j=(0,u.useState)([]),P=(0,m.Z)(j,2),O=P[0],G=P[1],A=(0,u.useState)([]),te=(0,m.Z)(A,2),pe=te[0],ge=te[1],xe=(0,u.useState)(""),b=(0,m.Z)(xe,2),S=b[0],N=b[1],L=(0,u.useState)([]),$=(0,m.Z)(L,2),Me=$[0],Q=$[1],Re=u.useState({}),z=(0,m.Z)(Re,2),ye=z[0],ne=z[1],me=u.useState({layout:"graphin-force",miniMapEnabled:!0,snapLineEnabled:!0,nodeTooltipEnabled:!0,edgeTooltipEnabled:!1,infoPanelEnabled:!0}),M=(0,m.Z)(me,2),U=M[0],It=M[1];(0,u.useEffect)(function(){var R=Oe(a.nodes);v(R);var d=Te(R,["comboId","style","data"]);D(d);var g=Oe(a.edges);ge(g);var x=Te(g,[]);G(x),console.log("Node & Edge Columns: ",d,x),p([[(0,e.jsxs)("span",{children:["Entities ",(0,e.jsx)(X.Z,{color:"#2db7f5",children:"canvas"})]}),a.nodes.length],[(0,e.jsxs)("span",{children:["Relationships ",(0,e.jsx)(X.Z,{color:"#2db7f5",children:"canvas"})]}),a.edges.length],[(0,e.jsxs)("span",{children:["Entities ",(0,e.jsx)(X.Z,{color:"#108ee9",children:"graph"})]}),"14,543,042"],[(0,e.jsxs)("span",{children:["Relationships ",(0,e.jsx)(X.Z,{color:"#108ee9",children:"graph"})]}),"188,266,233"]])},[a]);var Ft=function(d,g){ne(g),It(d)},At=function(d,g){d&&g&&Le({query_str:fe("(n:".concat(d,")-[r]-(m)"),"n.id = '".concat(g,"'"))}).then(function(x){o(x)}).catch(function(x){W.ZP.warn("Unknown error, please retry later."),console.log("getNodes Error: ",x)})},Kt=function(d,g){d&&g&&Le({query_str:fe("(n:".concat(d,")-[r]-(m)"),"id(n) = ".concat(g))}).then(function(x){var w={nodes:(0,k.uniqBy)([].concat((0,J.Z)(a.nodes),(0,J.Z)(x.nodes)),"id"),edges:[].concat((0,J.Z)(a.edges),(0,J.Z)(x.edges))};o(w)}).catch(function(x){W.ZP.warn("Unknown error, please retry later."),console.log("getNodes Error: ",x)})},Wt=function(d,g,x,w){if(console.log("handleChange [".concat(d.name,"]: "),d,g),d.key=="delete"&&d.name=="Delete Node"){var K=g.id,ae=x.findById(K);ae&&x.removeItem(ae)}else if(d.key=="expand"&&d.name=="Expand One Level"){var we=g.nlabel,Ie=g.id;console.log("Expand node: ",we,Ie),Kt(we,Ie)}else W.ZP.warn("Don't support this action, please contact administrator.")},Ht={selectedRowKeys:Me},Bt=function(d){var g=u.Children.count(d.children),x=u.Children.toArray(d.children),w=[{label:"Nodes",key:"nodes",children:g>=2?x[0]:"No Content"},{label:"Edges",key:"edges",children:g>=2?x[1]:"No Content"}];return(0,e.jsx)(Ee.Z,{children:w.map(function(K){return(0,e.jsx)(Ee.Z.TabPane,{tab:K.label,children:K.children},K.key)})})},zt=function(d){var g=d.data,x=d.style,w=g.map(function(K,ae){return(0,e.jsx)(Y.Z.Item,{label:K[0],children:K[1]},ae)});return w.length>0?(0,e.jsx)(Y.Z,{size:"small",column:1,title:null,labelStyle:{backgroundColor:"transparent"},bordered:!0,style:(0,C.Z)({},x),children:w}):(0,e.jsx)("span",{style:x,children:"No Properties"})};return(0,e.jsxs)(Se.Z,{className:"knowledge-graph-container",children:[U!=null&&U.infoPanelEnabled?(0,e.jsx)(zt,{data:i,style:{position:"absolute",top:"15px",right:"15px",zIndex:1}}):null,(0,e.jsx)(bt,{config:U,onChangeConfig:Ft,style:{zIndex:10,position:"relative",maxWidth:"unset",maxHeight:"unset"}}),(0,e.jsx)(Pt,{onChange:At}),(0,e.jsxs)(je.Z,{className:"graphin",style:{width:"100%",height:"100%",position:"relative"},children:[(0,e.jsx)(be,{position:"right"}),(0,e.jsx)(be,{position:"bottom",children:(0,e.jsxs)(Bt,{children:[h.length>0?(0,e.jsx)(Ce.Z,{size:"small",scroll:{y:200},rowKey:"identity",dataSource:Z,columns:h,pagination:!1,onRow:function(d,g){return{onClick:function(w){console.log("Click the node item: ",w,d),N(d.identity),Q([d.identity])}}},rowSelection:(0,C.Z)({type:"radio"},Ht)}):null,h.length>0?(0,e.jsx)(Ce.Z,{size:"small",scroll:{y:200},rowKey:"id",dataSource:pe,columns:O,pagination:!1}):null]})}),(0,e.jsx)(st,{selectedNode:S,handleChange:Wt,config:U,data:a,layout:(0,C.Z)((0,C.Z)({},Lt),ye),style:Mt})]})]})},wt=Rt}}]);
