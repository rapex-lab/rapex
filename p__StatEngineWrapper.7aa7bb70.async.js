(self.webpackChunkrapex_studio=self.webpackChunkrapex_studio||[]).push([[277],{98361:function(Pe,re,t){"use strict";var Y=t(13254),j=t(14277),r=t(2824),a=t(43358),f=t(34041),k=t(96486),fe=t.n(k),$=t(67294),M=t(85893),G=f.Z.Option,p,ee;function D(c,s,y){console.log("makeQueryStr filter: ",y);var H=":select [:*]",o="",X="";if(s){var _=Object.keys(s)[0],T=Object.values(s)[0];_&&T&&(T==="ascend"?o=":order-by [:".concat(_,"]"):o=":order-by [[:".concat(_," :desc]]"))}if(c){for(var O=[],Q=0,z=Object.keys(c);Q<z.length;Q++){var te=z[Q];["current","pageSize"].indexOf(te)<0&&c[te].length>0&&O.push("[:like [:upper :".concat(te,'] [:upper "%').concat(c[te],'%"]]'))}O.length==1?X=":where ".concat(O[0]):O.length>1&&(X=":where [:or ".concat(O.join(" "),"]"))}return"{".concat(H," ").concat(o," ").concat(X,"}")}var de=function(s){var y=s.queryGenes,H=s.initialValue,o=(0,$.useState)([]),X=(0,r.Z)(o,2),_=X[0],T=X[1],O=(0,$.useState)([]),Q=(0,r.Z)(O,2),z=Q[0],te=Q[1],ie=(0,$.useState)(),ue=(0,r.Z)(ie,2),W=ue[0],ce=ue[1];(0,$.useEffect)(function(){H&&H!==W&&(ce(H),J(H,function(me){te(me),pe(H,{})}))},[H]);var J=function(Z,Me){p&&(clearTimeout(p),p=null),ee=Z;var ge=function(){y({query_str:D({gene_symbol:Z,ensembl_id:Z,entrez_id:Z},{},{})}).then(function(e){if(ee===Z){var ve=e.data,Ve=ve.map(function(Ze){return{value:Ze.ensembl_id,text:"".concat(Ze.gene_symbol," | ").concat(Ze.entrez_id," | ").concat(Ze.ensembl_id)}});Me(Ve),T(ve)}}).catch(function(e){console.log("requestDEGs Error: ",e),Me([])})};p=setTimeout(ge,300)},je=function(Z){Z?J(Z,te):te([])},pe=function(Z,Me){if(ce(Z),console.log("GeneSearcher handleChange: ",Z),Z&&typeof Z=="string"){var ge,Ae=(0,k.filter)(_,function(ve){return Z.match(/ENS/i)?ve.ensembl_id==Z:Z.match(/[a-zA-Z][a-zA-Z0-9]+/i)?ve.gene_symbol==Z:Z.match(/[0-9]+/i)?ve.entrez_id.toString()==Z:!1});console.log("handleChange(GeneSearcher): ",Ae,_),(ge=s.onChange)===null||ge===void 0||ge.call(s,Z,Ae[0])}else{var e;(e=s.onChange)===null||e===void 0||e.call(s,Z,void 0)}},ze=z.map(function(me){return(0,M.jsx)(G,{children:me.text},me.value)});return(0,M.jsx)(f.Z,{allowClear:!0,showSearch:!0,value:W,placeholder:s==null?void 0:s.placeholder,style:s.style,defaultActiveFirstOption:!1,showArrow:!0,filterOption:!1,onSearch:je,onChange:pe,mode:s!=null&&s.mode?s==null?void 0:s.mode:"single",notFoundContent:(0,M.jsx)(j.Z,{description:"Searching ..."}),children:ze})};re.Z=de},23082:function(Pe,re,t){"use strict";var Y=t(13254),j=t(14277),r=t(2824),a=t(67294),f=t(66349),k=t(27360),fe=t(63183),$=t.n(fe),M=t(11759),G=t(79576),p=t(56592),ee=t(10043),D=t.n(ee),de=t(29931),c=t(50437),s=t(85893),y=function(o){var X=o.url,_=o.getFile,T=o.enableToc,O=function(ce){if(ce.match(/^(minio|file):\/\//))return _?_({filelink:ce}).then(function(J){return J}).catch(function(J){return J.data.msg?J.data.msg:J.data}):new Promise(function(J,je){J("Please specify getFile function.")});try{return(0,c.Z)(ce).then(function(J){return J.status!==200?"No Content.":J.data})}catch(J){return console.log("Cannot fetch ".concat(ce,", the reason is ").concat(J)),new Promise(function(je,pe){pe("No Content.")})}},Q=(0,a.useState)(null),z=(0,r.Z)(Q,2),te=z[0],ie=z[1];(0,a.useEffect)(function(){X&&O(X).then(function(W){return ie(W||null)})},[X]),console.log("MarkdownViewer: updated");var ue=[];return T?ue=[k.Z,G.Z,$(),p.Z,M.Z]:ue=[k.Z,G.Z,p.Z,M.Z],te?(0,s.jsx)(f.D,{rehypePlugins:ue,className:"markdown-viewer",remarkPlugins:[D(),de.Z],children:te},X):(0,s.jsx)(j.Z,{})};re.Z=(0,a.memo)(y)},23658:function(Pe,re,t){"use strict";t.d(re,{Z:function(){return s}});var Y=t(8870),j=t(69610),r=t(54941),a=t(81306),f=t(59206),k=t(25478),fe=t.n(k),$=t(67294),M=t(66979),G=t.n(M),p=t(58660),ee=t(74310),D=t(75503),de=t.n(D),c=t(85893),s=function(y){(0,a.Z)(o,y);var H=(0,f.Z)(o);function o(X){var _;return(0,j.Z)(this,o),_=H.call(this,X),_.handleUpdate=function(T,O,Q){_.props.handleUpdate&&_.props.handleUpdate({data:T,layout:O,frames:Q})},_.handleRender=function(T,O,Q){_.props.handleUpdate&&_.props.handleUpdate({data:T,layout:O,frames:Q})},_.handleResize=function(){_.ref.state.graphDiv instanceof HTMLElement&&k.Plots.resize(_.ref.state.graphDiv)},_.ref=void 0,_}return(0,r.Z)(o,[{key:"render",value:function(){var _=this,T={toImageButtonOptions:{format:"svg",filename:"custom_image",height:1e3,width:1e3,scale:1},editable:!0,scrollZoom:!1,displaylogo:!1,displayModeBar:!0,showTips:!0,responsive:!0,locales:{"zh-CN":D},locale:(0,ee.Kd)()};console.log("PlotlyViewer updated: ",this.props.mode);var O=this.props.plotlyData||{data:[],layout:{}},Q=O.data,z=O.layout,te=O.frames;return z=(0,Y.Z)((0,Y.Z)({},z),{},{margin:{t:50,r:50,b:50,l:50}}),this.props.mode==="Plotly"?(0,c.jsx)(p.Z,{ref:function(ue){_.ref=ue},useResizeHandler:!0,className:"plotly-viewer",data:Q,layout:z,config:T}):(0,c.jsx)("div",{className:"plotly-editor",children:(0,c.jsx)(G(),{ref:function(ue){_.ref=ue},data:Q,layout:z,config:T,frames:te,plotly:k,onUpdate:this.handleUpdate,onRender:this.handleRender,useResizeHandler:!0,debug:!0,advancedTraceTypeSelector:!0})})}}]),o}($.PureComponent)},1292:function(Pe,re,t){"use strict";t.r(re),t.d(re,{default:function(){return $t}});var Y=t(18106),j=t(38222),r=t(2824),a=t(67294),f=t(74310),k=t(20228),fe=t(11382),$=t(13062),M=t(71230),G=t(89032),p=t(15746),ee=t(9715),D=t(55843),de=t(34792),c=t(48086),s=t(8870),y=t(21349),H=t(15873),o=t(68628),X=t(13254),_=t(14277),T=t(39428),O=t(3182),Q=t(49111),z=t(19650),te=t(22385),ie=t(94199),ue=t(57663),W=t(71577),ce=t(8212),J=t(84391),je=t(90631),pe=t(54787),ze=t(19412),me=t(53674),Z=t(98361),Me=t(50220),ge={import:{id:"stat-engine.argument-form.import",defaultMessage:"\u5BFC\u5165"},importTooltip:{id:"stat-engine.argument-form.import-tooltip",defaultMessage:"\u5BFC\u5165\u53C2\u6570\u6587\u4EF6"},export:{id:"stat-engine.argument-form.export",defaultMessage:"\u5BFC\u51FA"},exportTooltip:{id:"stat-engine.argument-form.export-tooltip",defaultMessage:"\u5BFC\u51FA\u53C2\u6570"}},Ae=null,e=t(85893),ve=function(n){var m=n.columns,l=n.height,h=n.labelSpan,S=n.onSubmit,v=n.queryGenes,E=n.fieldsValue,C=(0,e.jsx)(Me.Z,{label:"Editor",style:{width:"50%"},labelCol:{span:6},wrapperCol:{span:18},children:(0,e.jsxs)(W.Z,{style:{width:"100%"},children:[(0,e.jsx)(ce.Z,{}),"Edit"]})}),U=(0,a.useState)("QueryFilter"),V=(0,r.Z)(U,2),ae=V[0],q=V[1],A=D.Z.useForm(),B=(0,r.Z)(A,1),x=B[0],w=(0,f.YB)(),F={};Object.keys(ge).forEach(function(d){F[d]=w.formatMessage(ge[d])}),(0,a.useEffect)(function(){x.resetFields()},[m]),(0,a.useEffect)(function(){E&&x.setFieldsValue(E)},[E]),console.log("ArgumentForm updated");var P=(0,a.useContext)(pe.L_);return m.length>0?(0,e.jsx)(M.Z,{className:"argument-form",children:(0,e.jsxs)(pe.L_.Provider,{value:(0,s.Z)((0,s.Z)({},P),{},{valueTypeMap:{gene_searcher:{render:function(g){return(0,e.jsx)("a",{children:g})},renderFormItem:function(g,u){var i,R;console.log("Gene Searcher Component: ",u,x.getFieldValue(u==null?void 0:u.id));var K=x.getFieldValue(u==null?void 0:u.id);return(0,e.jsx)(Z.Z,(0,s.Z)((0,s.Z)({placeholder:"Enter gene symbol, entrez id or ensembl id",queryGenes:v,initialValue:K||(u==null||(i=u.formItemProps)===null||i===void 0?void 0:i.initialValue)},u==null?void 0:u.fieldProps),{},{mode:u==null||(R=u.fieldProps)===null||R===void 0?void 0:R.mode,style:{width:"100%"}}))}}}}),children:[(0,e.jsxs)(p.Z,{className:"argument-form__header",style:{display:"none"},children:[(0,e.jsx)(ze.Z,{label:"Layout",labelCol:{span:8},wrapperCol:{span:16},options:["ModalForm","QueryFilter"],fieldProps:{value:ae,onChange:function(g){return q(g)}}}),(0,e.jsxs)(z.Z,{className:"btn-group",style:{display:"none"},children:[(0,e.jsx)(ie.Z,{title:F.importTooltip,children:(0,e.jsx)(W.Z,{disabled:!0,icon:(0,e.jsx)(J.Z,{}),children:"".concat(F.import)})}),(0,e.jsx)(ie.Z,{title:F.exportTooltip,children:(0,e.jsx)(W.Z,{disabled:!0,icon:(0,e.jsx)(je.Z,{}),children:"".concat(F.export)})})]})]}),(0,e.jsx)(me.Z,{className:"schema-form vertical",trigger:C,style:{height:l},span:h,form:x,defaultCollapsed:!1,layoutType:ae,layout:"vertical",onFinish:function(){var d=(0,O.Z)((0,T.Z)().mark(function g(u){return(0,T.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:S&&S(u).then(function(K){console.log("onSubmit ArgumentForm: ",K)}).catch(function(K){console.log("onSubmit ArgumentForm Error: ",K)});case 1:case"end":return R.stop()}},g)}));return function(g){return d.apply(this,arguments)}}(),columns:m})]})}):(0,e.jsx)(_.Z,{})},Ve=(0,a.memo)(ve),Ze=t(23082),ct=function(n){var m=n.HoverHandler,l=n.ClickHandler,h=n.btnActive,S=n.style,v=n.className;return console.log("Resizer updated"),(0,e.jsx)(p.Z,{style:S,className:"resizer ".concat(v),onMouseEnter:function(){m(!0)},onMouseLeave:function(){m(!1)},children:h?(0,e.jsxs)(z.Z,{children:[(0,e.jsx)(W.Z,{onClick:function(){l(12)},className:"resize-btn btn-1",size:"small",children:"1:1"}),(0,e.jsx)(W.Z,{onClick:function(){l(16)},className:"resize-btn btn-2",size:"small",children:"2:1"}),(0,e.jsx)(W.Z,{onClick:function(){l(8)},className:"resize-btn btn-3",size:"small",children:"1:2"}),(0,e.jsx)(W.Z,{onClick:function(){l(24)},className:"resize-btn btn-4",size:"small",children:"Full"})]}):null})},ht=(0,a.memo)(ct),Qt=t(57338),we=t(273),tt=t(57820),mt=t(34654),ft=t(21444),at=t(93179),gt=t(73888),Xt=t(71153),vt=t(60331),qt=t(54421),Ye=t(38272),_t=t(58812),xt=t(81825),pt=t(25559),yt=t(96486),Et=t(51615),De=t(16629),nt={totalItems:{id:"stat-engine.chart-list.totalItems",defaultMessage:"\u603B\u6570"}},ea=null,jt=function(n){var m=n.onClickItem,l=(0,a.useState)([]),h=(0,r.Z)(l,2),S=h[0],v=h[1],E=(0,a.useState)(0),C=(0,r.Z)(E,2),U=C[0],V=C[1],ae=(0,Et.k6)(),q=(0,f.YB)(),A={};Object.keys(nt).forEach(function(P){A[P]=q.formatMessage(nt[P])}),(0,a.useEffect)(function(){(0,De.HN)({}).then(function(P){var d=(0,yt.filter)(P.data,function(g){return g.category==="Chart"});v(d),V(d.length)})},[]);var B=function(d){var g=d.icon,u=d.text;return(0,e.jsxs)(z.Z,{children:[a.createElement(g),u]})},x=function(d){return"".concat(A.totalItems,": ").concat(d)},w=function(d){return d[0].src?d[0].src:""},F=function(d,g){return(0,e.jsx)("a",{className:"title",children:"".concat(d,"- ").concat(g)})};return console.log("ChartList updated"),(0,e.jsx)(Ye.ZP,{className:"chart-list",itemLayout:"vertical",size:"large",grid:{xs:1,sm:1,md:1,lg:1,xl:2,xxl:2},pagination:{onChange:function(d){console.log(d)},pageSize:10,total:U,showTotal:x,showSizeChanger:!0,showQuickJumper:!0},dataSource:S,renderItem:function(d){return(0,e.jsxs)(Ye.ZP.Item,{className:"chart-item",onClick:function(){m?m(d,void 0,void 0):ae.push("/stat-engine/index",{chart:d,result:null})},actions:[(0,e.jsx)(B,{icon:_t.Z,text:"156"},"list-vertical-star-o"),(0,e.jsx)(B,{icon:xt.Z,text:"1"},"list-vertical-like-o"),(0,e.jsx)(B,{icon:pt.Z,text:"2"},"list-vertical-message")],extra:(0,e.jsx)("img",{alt:"logo",src:w(d.icons)}),children:[(0,e.jsx)(Ye.ZP.Item.Meta,{title:F(d.name,d.version),description:d.maintainers}),(0,e.jsx)("span",{className:"description",children:d.description}),d.tags.map(function(g){return(0,e.jsx)(vt.Z,{children:g},g)})]},d.short_name)}})},Zt=(0,a.memo)(jt),St=t(25592),Ct=t(22732),Pt=function(n){var m=n.url,l=n.height,h=n.getFile,S=(0,a.useState)(""),v=(0,r.Z)(S,2),E=v[0],C=v[1],U=(0,e.jsxs)(z.Z,{style:{marginTop:"5px",display:"flex",justifyContent:"flex-end"},children:[(0,e.jsx)(W.Z,{icon:(0,e.jsx)(St.Z,{}),children:"Force Update"}),(0,e.jsx)(W.Z,{icon:(0,e.jsx)(je.Z,{}),children:"Download"})]}),V=function(){if(m.length>0)var q=setInterval(function(){h({filelink:m}).then(function(A){console.log("Load Log: ",A),C(A.msg),clearInterval(q)}).catch(function(A){console.log("Fetch log error, the reason is ".concat(A)),C("Cannot get the log, please retry later."),clearInterval(q)})},1e3)};return(0,a.useEffect)(V,[m]),console.log("LogViewer updated"),m?E?(0,e.jsxs)(p.Z,{className:"log-container",children:[(0,e.jsx)(Ct.ZP,{bodyStyle:{height:l,overflowY:"auto"},log:E}),U]}):(0,e.jsx)(p.Z,{className:"spinning",children:(0,e.jsx)(fe.Z,{})}):(0,e.jsx)(_.Z,{})},Mt=(0,a.memo)(Pt),Dt=t(23658),st=t(93224),Tt=t(70844),Ot=t(16894),It=t(12826),bt=null;function Rt(L,n){return $e.apply(this,arguments)}function $e(){return $e=(0,O.Z)((0,T.Z)().mark(function L(n,m){return(0,T.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,f.WY)("/api/v1/tasks",(0,s.Z)({method:"GET",params:(0,s.Z)({},n)},m||{})));case 1:case"end":return h.stop()}},L)})),$e.apply(this,arguments)}function ta(L,n){return Je.apply(this,arguments)}function Je(){return Je=_asyncToGenerator(_regeneratorRuntime().mark(function L(n,m){return _regeneratorRuntime().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",request("/api/v1/tasks",_objectSpread({method:"POST",headers:{"Content-Type":"application/json"},data:n},m||{})));case 1:case"end":return h.stop()}},L)})),Je.apply(this,arguments)}function aa(L,n){return Qe.apply(this,arguments)}function Qe(){return Qe=_asyncToGenerator(_regeneratorRuntime().mark(function L(n,m){var l,h;return _regeneratorRuntime().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=n.id,h=_objectWithoutProperties(n,bt),v.abrupt("return",request("/api/v1/tasks/".concat(l),_objectSpread({method:"DELETE",params:_objectSpread({},h)},m||{})));case 2:case"end":return v.stop()}},L)})),Qe.apply(this,arguments)}var Lt=["defaultRender"],At=["defaultRender"];function rt(L){return Promise.resolve((0,s.Z)((0,s.Z)({},L),{},{success:!0}))}var Bt=function(n){var m=n.onClickItem,l=n.pluginName,h=n.forceUpdateKey,S=(0,a.useState)(!1),v=(0,r.Z)(S,2),E=v[0],C=v[1],U=(0,a.useState)(),V=(0,r.Z)(U,2),ae=V[1];(0,a.useEffect)(function(){ae("")},[h]);var q=(0,a.useRef)(),A=(0,a.useState)(),B=(0,r.Z)(A,2),x=B[0],w=B[1],F=function(){var g=(0,O.Z)((0,T.Z)().mark(function u(i,R,K){var se;return(0,T.Z)().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return se={page:i.current,pape_size:i.pageSize},l&&(se.plugin_name=l),K.status&&(se.status=K.status),i.status&&(se.status=i.status),console.log("List Tasks: ",se,i),he.next=7,Rt(se).then(function(_e){return rt(_e)}).catch(function(_e){return console.log("requestDEGs Error: ",_e),rt({total:0,page:1,page_size:10,data:[]})});case 7:return he.abrupt("return",he.sent);case 8:case"end":return he.stop()}},u)}));return function(i,R,K){return g.apply(this,arguments)}}(),P=(0,f.YB)(),d=[{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.id",defaultMessage:"Task ID"}),dataIndex:"id",tip:"The task id is the unique key",hideInTable:!1,hideInSearch:!0,hideInForm:!0,render:function(u,i){return(0,e.jsx)("a",{onClick:function(){m&&m(i.plugin_name,i.response,i)},children:u})}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.taskName",defaultMessage:"Task Name"}),dataIndex:"name",hideInSearch:!0,hideInForm:!0,hideInTable:!0,tip:"The task name is the unique key",render:function(u,i){return(0,e.jsx)("a",{onClick:function(){w(i),C(!0)},children:u})}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.pluginName",defaultMessage:"Chart Name"}),dataIndex:"plugin_name",valueType:"text",render:function(u,i){return(0,e.jsx)("a",{onClick:function(){w(i),C(!0)},children:u})}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.pluginVersion",defaultMessage:"Version"}),dataIndex:"plugin_version",hideInSearch:!0,hideInForm:!0,valueType:"text"},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.percentage",defaultMessage:"Percentage"}),dataIndex:"percentage",hideInSearch:!0,hideInForm:!0,hideInTable:!0,hideInSetting:!0,valueType:"progress"},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.status",defaultMessage:"Status"}),dataIndex:"status",hideInForm:!0,valueEnum:{Started:{text:(0,e.jsx)(f._H,{id:"stat-engine.history-table.started",defaultMessage:"Started"}),status:"Processing"},Finished:{text:(0,e.jsx)(f._H,{id:"stat-engine.history-table.finished",defaultMessage:"Finished"}),status:"Success"},Failed:{text:(0,e.jsx)(f._H,{id:"stat-engine.history-table.failed",defaultMessage:"Failed"}),status:"Error"}}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.startedAt",defaultMessage:"Started"}),dataIndex:"started_time",hideInSearch:!0,valueType:"dateTime",renderFormItem:function(u,i,R){var K=i.defaultRender,se=(0,st.Z)(i,Lt);return K(u)}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.finishedAt",defaultMessage:"Finished"}),hideInSearch:!0,dataIndex:"finished_time",valueType:"dateTime",renderFormItem:function(u,i,R){var K=i.defaultRender,se=(0,st.Z)(i,At);return K(u)}},{title:(0,e.jsx)(f._H,{id:"stat-engine.history-table.payload",defaultMessage:"Payload"}),dataIndex:"payload",hideInSearch:!0,hideInForm:!0,hideInTable:!0,hideInSetting:!0,valueType:"jsonCode",renderText:function(u,i,R,K){return JSON.stringify(u)},colSpan:2}];return(0,e.jsxs)(Tt.ZP,{className:"history-table-page-container",children:[(0,e.jsx)(Ot.ZP,{className:"history-table",headerTitle:P.formatMessage({id:"stat-engine.history-table.title",defaultMessage:"Task History"}),actionRef:q,rowKey:"id",search:{labelWidth:120},toolBarRender:function(){return[]},request:F,columns:d}),(0,e.jsx)(we.Z,{width:"50%",visible:E,className:"task-details",onClose:function(){w(void 0),C(!1)},closable:!1,children:(x==null?void 0:x.name)&&(0,e.jsx)(It.ZP,{column:1,title:x==null?void 0:x.name,request:(0,O.Z)((0,T.Z)().mark(function g(){return(0,T.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",{data:x||{}});case 1:case"end":return i.stop()}},g)})),params:{id:x==null?void 0:x.name},columns:d})})]})},Kt=Bt,lt=t(48137),Wt=t(83461),Be=t(97193),ot={figure:{id:"stat-engine.result-panel.figure",defaultMessage:"\u4EA4\u4E92\u56FE\u8868"},results:{id:"stat-engine.result-panel.results",defaultMessage:"\u7ED3\u679C"},data:{id:"stat-engine.result-panel.data",defaultMessage:"\u6570\u636E"},download:{id:"stat-engine.result-panel.download",defaultMessage:"\u4E0B\u8F7D"},metadata:{id:"stat-engine.result-panel.metadata",defaultMessage:"\u5143\u6570\u636E"},log:{id:"stat-engine.result-panel.log",defaultMessage:"\u65E5\u5FD7"},edit:{id:"stat-engine.result-panel.edit",defaultMessage:"\u7F16\u8F91"},charts:{id:"stat-engine.result-panel.charts",defaultMessage:"\u56FE\u8868\u5E93"},history:{id:"stat-engine.result-panel.history",defaultMessage:"\u5386\u53F2\u8BB0\u5F55"}},na=null,Ke=j.Z.TabPane,Ut=function(n,m){var l="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),h=document.getElementById(m);h?(h.setAttribute("href",l),h.setAttribute("download","metadata.json"),h.click()):console.log("No such html tag ".concat(m)),console.log("Download ".concat(m))},Ft=function(n){var m=(0,f.YB)(),l={};Object.keys(ot).forEach(function(I){l[I]=m.formatMessage(ot[I])});var h=n.onClickItem,S=n.logLink,v=n.responsiveKey,E=n.currentChart,C=n.taskId,U=n.results,V=n.charts,ae=(0,a.useState)(void 0),q=(0,r.Z)(ae,2),A=q[0],B=q[1],x=(0,a.useState)("Plotly"),w=(0,r.Z)(x,2),F=w[0],P=w[1],d=(0,a.useState)(!1),g=(0,r.Z)(d,2),u=g[0],i=g[1],R=(0,a.useState)(!1),K=(0,r.Z)(R,2),se=K[0],Te=K[1],he=(0,a.useState)(!1),_e=(0,r.Z)(he,2),Oe=_e[0],Ie=_e[1],Xe=(0,a.useState)("chart"),We=(0,r.Z)(Xe,2),be=We[0],Ue=We[1],Fe=(0,a.useState)(null),Ne=(0,r.Z)(Fe,2),Se=Ne[0],ne=Ne[1],Ce=(0,a.useState)(null),ke=(0,r.Z)(Ce,2),Ge=ke[0],qe=ke[1];(0,a.useEffect)(function(){V.length>0&&(console.log("Chart Task: ",C),(0,Be.n)({filelink:V[0]}).then(function(I){qe({data:I.data,layout:I.layout,frames:I.frames||void 0})}).catch(function(I){c.ZP.warn("Cannot fetch the result, please retry later.")}))},[V]),(0,a.useEffect)(function(){U.length>0&&(console.log("Data: ",C),(0,Be.n)({filelink:U[0]}).then(function(I){ne(I)}).catch(function(I){c.ZP.warn("Cannot fetch the result, please retry later.")}))},[U]),(0,a.useEffect)(function(){S.length>0?Te(!0):Te(!1)},[S]);var Re=(0,e.jsxs)(z.Z,{children:[(0,e.jsx)(ie.Z,{title:"Edit the Chart",children:(0,e.jsx)(W.Z,{disabled:!se,style:be==="chart"?{}:{display:"none"},type:"primary",icon:(0,e.jsx)(ce.Z,{}),onClick:function(){P("PlotlyEditor")},children:l.edit})}),(0,e.jsx)(ie.Z,{title:"List all charts",children:(0,e.jsx)(W.Z,{style:{display:"none"},onClick:function(){i(!0)},icon:(0,e.jsx)(tt.Z,{}),children:l.charts})}),(0,e.jsx)(ie.Z,{title:"List all history",children:(0,e.jsx)(W.Z,{onClick:function(){Ie(!0)},icon:(0,e.jsx)(mt.Z,{}),children:l.history})})]});return console.log("ResultPanel updated"),(0,e.jsxs)(M.Z,{className:"result-panel",children:[(0,e.jsxs)(j.Z,{onChange:function(ye){Ue(ye)},activeKey:be,className:"tabs-result",tabBarExtraContent:Re,children:[(0,e.jsx)(Ke,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(tt.Z,{}),l.figure]}),children:(0,e.jsxs)(p.Z,{id:"graph-container",className:`result-container
        `.concat(F==="PlotlyEditor"?"full-screen":"no-full-screen"),children:[F==="PlotlyEditor"?(0,e.jsxs)(W.Z,{className:"exit-editor",onClick:function(){P("Plotly")},children:[(0,e.jsx)(ft.Z,{}),"Exit Editor"]}):null,(0,e.jsx)(Dt.Z,{responsiveKey:v,plotlyData:Ge,mode:F},V[0])]})},"chart"),(0,e.jsx)(Ke,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(at.Z,{}),l.log]}),children:(0,e.jsx)(Mt,{getFile:Be.n,height:"calc(100vh - 200px)",url:S})},"log"),Se?(0,e.jsxs)(Ke,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(gt.Z,{}),l.data]}),children:[(0,e.jsxs)(Wt.CSVLink,{data:Se,filename:"data.csv",className:"button",children:[l.download," ",l.data]}),(0,e.jsx)(lt.he,{value:Se})]},"data"):null,A?(0,e.jsxs)(Ke,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(at.Z,{}),l.metadata]}),children:[(0,e.jsxs)("a",{className:"button",onClick:function(){Ut(A,"download-anchor")},children:[l.download," ",l.metadata]}),(0,e.jsx)("a",{id:"download-anchor",style:{display:"none"}}),(0,e.jsx)(lt.he,{value:A})]},"metadata"):null]}),(0,e.jsx)(we.Z,{title:"Chart Store",placement:"right",closable:!0,width:"70%",onClose:function(){i(!1)},visible:u,children:(0,e.jsx)(Zt,{onClickItem:function(ye,Le,Ee){h(ye.short_name,Le,Ee),i(!1)}})}),(0,e.jsx)(we.Z,{title:"Chart History",placement:"right",closable:!0,className:"history-table-drawer",width:"70%",onClose:function(){Ie(!1)},visible:Oe,children:(0,e.jsx)(Kt,{forceUpdateKey:"".concat(Oe),pluginName:E||void 0,onClickItem:function(ye,Le,Ee){h(ye,Le,Ee?Ee.payload:void 0),Ie(!1),B(Ee)}})})]})},Nt=(0,a.memo)(Ft),sa=t(43358),it=t(34041),kt=it.Z.Option,Gt=function(n){var m=n.listDatasets,l=n.initialValue,h=(0,a.useState)([]),S=(0,r.Z)(h,2),v=S[0],E=S[1],C=(0,a.useState)(),U=(0,r.Z)(C,2),V=U[0],ae=U[1];(0,a.useEffect)(function(){if(l){var B;ae(l),(B=n.onChange)===null||B===void 0||B.call(n,l)}v.length==0&&m().then(function(x){var w=x.map(function(F){return{value:F.key,text:F.text}});E(w)}).catch(function(x){return console.log("listDatasets Error: ",x),E([])})},[l,V]);var q=function(x){var w;ae(x),(w=n.onChange)===null||w===void 0||w.call(n,x)},A=v.map(function(B){return(0,e.jsx)(kt,{children:B.text},B.value)});return(0,e.jsx)(it.Z,{allowClear:!0,showSearch:!0,value:V,placeholder:n==null?void 0:n.placeholder,style:n.style,defaultActiveFirstOption:!1,showArrow:!0,filterOption:!1,onChange:q,notFoundContent:(0,e.jsx)(_.Z,{description:"No Dataset"}),children:A})},Ht=Gt,zt=t(32266),ut={resetTooltip:{id:"stat-engine.reset-tooltip",defaultMessage:"\u91CD\u7F6E\u6570\u636E\u4E0E\u53C2\u6570"},reset:{id:"stat-engine.reset",defaultMessage:"\u91CD\u7F6E"},exampleTooltip:{id:"stat-engine.example-tooltip",defaultMessage:"\u52A0\u8F7D\u793A\u4F8B\u6570\u636E"},example:{id:"stat-engine.example",defaultMessage:"\u793A\u4F8B"},loadData:{id:"stat-engine.load-data",defaultMessage:"\u52A0\u8F7D\u6570\u636E"},summary:{id:"stat-engine.summary",defaultMessage:"\u6587\u6863"},arguments:{id:"stat-engine.arguments",defaultMessage:"\u53C2\u6570\u5217\u8868"}},ra=null,dt=j.Z.TabPane,Vt=function(n){var m=(0,f.YB)();console.log("StatEngine Props: ",n);var l={};Object.keys(ut).forEach(function(le){l[le]=m.formatMessage(ut[le])});var h=(0,a.useState)(8),S=(0,r.Z)(h,2),v=S[0],E=S[1],C=(0,a.useState)(!1),U=(0,r.Z)(C,2),V=U[0],ae=U[1],q=(0,a.useState)("arguments"),A=(0,r.Z)(q,2),B=A[0],x=A[1],w=(0,a.useState)("000000"),F=(0,r.Z)(w,2),P=F[0],d=F[1],g=(0,a.useState)(""),u=(0,r.Z)(g,2),i=u[0],R=u[1],K=(0,a.useState)(""),se=(0,r.Z)(K,2),Te=se[0],he=se[1],_e=(0,a.useState)([]),Oe=(0,r.Z)(_e,2),Ie=Oe[0],Xe=Oe[1],We=(0,a.useState)({}),be=(0,r.Z)(We,2),Ue=be[0],Fe=be[1],Ne=(0,a.useState)({results:[],charts:[],task_id:"",log:""}),Se=(0,r.Z)(Ne,2),ne=Se[0],Ce=Se[1],ke=(0,a.useState)(!1),Ge=(0,r.Z)(ke,2),qe=Ge[0],Re=Ge[1];(0,a.useEffect)(function(){var le=n.chart;R(le||"boxplot")},[n.chart]);var I=function(N,oe,b){(0,De.lM)({chart_name:oe,dataset:N}).then(function(He){var xe=(0,s.Z)({},He.schema);he("".concat(He.readme,"?=").concat((Math.random()+1).toString(36).substring(7))),Xe(xe.fields),b&&Fe(b)})},ye=function(N,oe,b){console.log("Restore Chart: ",N,oe,b),b&&(Fe(b),R(N),d(b.dataset)),Ce(oe||void 0)},Le=function(N){x(N)},Ee=function(N){var oe=setInterval(function(){N.length>0&&(0,De.gJ)({id:N}).then(function(b){b.status==="Finished"?(Ce({results:b.response.results,charts:b.response.charts,log:b.response.log,task_id:b.response.task_id}),Re(!1),c.ZP.success("Load chart..."),clearInterval(oe)):b.status==="Failed"&&(Ce({results:b.response.results,charts:b.response.charts,log:b.response.log,task_id:b.response.task_id}),Re(!1),c.ZP.error("Something wrong, please check the log for more details."),clearInterval(oe))}).catch(function(b){console.log("Get Task Error: ",b),clearInterval(oe)})},1e3)},Jt=function(N){var oe=i||"";return console.log("onSubmit Chart: ",i,N),N=(0,s.Z)((0,s.Z)({},N),{},{dataset:P}),new Promise(function(b,He){(0,De.LV)({chart_name:oe},N).then(function(xe){console.log("Post Chart: ",xe),c.ZP.success("Create the chart ".concat(oe," successfully.")),Re(!0),Ee(xe.task_id),b(xe)}).catch(function(xe){c.ZP.warn("Unknown error, please retry later."),console.log("Post Chart Error: ",xe),He(xe)})})},et=function(N){return 24-N?24-N:24};return(0,a.useEffect)(function(){i&&P&&I(P,i,Ue)},[i,P]),(0,e.jsx)(y.Z,{children:(0,e.jsx)(fe.Z,{spinning:qe,style:{marginTop:"50px"},children:(0,e.jsxs)(M.Z,{className:"stat-engine",gutter:8,children:[(0,e.jsx)(p.Z,{className:"left",xxl:v,xl:v,lg:v,md:24,sm:24,xs:24,children:(0,e.jsxs)(M.Z,{className:"left__content",children:[(0,e.jsx)(p.Z,{className:"left__tabs",children:(0,e.jsxs)(j.Z,{onChange:function(N){Le(N)},activeKey:B,defaultActiveKey:"arguments",className:"left__tabs__arguments",children:[(0,e.jsxs)(dt,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(H.Z,{}),l.arguments]}),children:[(0,e.jsx)(D.Z,{layout:"vertical",children:(0,e.jsx)(D.Z.Item,{label:"Data Set",name:"dataset",rules:[{required:!0,message:"Please select a dataset!"}],children:(0,e.jsx)(Ht,{listDatasets:De.EX,placeholder:"Select a dataset",initialValue:P,onChange:d,style:{}})})}),(0,e.jsx)(Ve,{queryGenes:zt.VX,fieldsValue:Ue,labelSpan:24,height:"calc(100% - 10px)",onSubmit:Jt,columns:Ie})]},"arguments"),(0,e.jsx)(dt,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(o.Z,{}),l.summary]}),children:(0,e.jsx)(Ze.Z,{getFile:Be.n,url:Te})},"summary")]})}),(0,e.jsx)(ht,{className:"left__divider",HoverHandler:ae,ClickHandler:E,btnActive:V})]})}),(0,e.jsx)(p.Z,{className:"right",xxl:et(v),xl:et(v),lg:et(v),md:24,sm:24,xs:24,children:(0,e.jsx)(M.Z,{className:"right__content",children:(0,e.jsx)(Nt,{currentChart:i,results:(ne==null?void 0:ne.results)||[],charts:(ne==null?void 0:ne.charts)||[],taskId:(ne==null?void 0:ne.task_id)||"",responsiveKey:v,logLink:(ne==null?void 0:ne.log)||"",onClickItem:ye})})})]})})})},wt=Vt,Yt=function(n){var m=n.chart,l=(0,a.useState)("boxplot"),h=(0,r.Z)(l,2),S=h[0],v=h[1],E=[{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.boxplot",defaultMessage:"Boxplot"}),key:"boxplot"},{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.barplot",defaultMessage:"Barplot"}),key:"barplot"},{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.across-organs-boxplot",defaultMessage:"Across Organs (Boxplot)"}),key:"boxplot-organs"},{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.across-organs-barplot",defaultMessage:"Across Organs (Barplot)"}),key:"barplot-organs"},{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.correlation-analysis",defaultMessage:"Correlation Analysis"}),key:"corrplot"},{label:(0,e.jsx)(f._H,{id:"pages.StatEngineWrapper.multiple-genes-comparison",defaultMessage:"Multiple Genes Comparison"}),key:"multiple-genes-comparison"}];return(0,a.useEffect)(function(){m?v(m):n.location.query.chart&&v(n.location.query.chart)},[m]),(0,e.jsx)(j.Z,{className:"stat-engine-container",activeKey:S,onChange:function(U){v(U)},children:E.map(function(C){return(0,e.jsx)(j.Z.TabPane,{tab:C.label,children:(0,e.jsx)(wt,{chart:C.key})},C.key)})})},$t=Yt},97193:function(Pe,re,t){"use strict";t.d(re,{n:function(){return f}});var Y=t(39428),j=t(8870),r=t(3182),a=t(74310);function f(M,G){return k.apply(this,arguments)}function k(){return k=(0,r.Z)((0,Y.Z)().mark(function M(G,p){return(0,Y.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",(0,a.WY)("/api/v1/download",(0,j.Z)({method:"GET",params:(0,j.Z)({},G)},p||{})));case 1:case"end":return D.stop()}},M)})),k.apply(this,arguments)}function fe(M,G,p){return $.apply(this,arguments)}function $(){return $=_asyncToGenerator(_regeneratorRuntime().mark(function M(G,p,ee){var D;return _regeneratorRuntime().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return D=new FormData,p&&D.append("files",p),Object.keys(G).forEach(function(s){var y=G[s];y!=null&&D.append(s,typeof y=="object"&&!(y instanceof File)?JSON.stringify(y):y)}),c.abrupt("return",request("/api/v1/upload",_objectSpread({method:"POST",data:D,requestType:"form"},ee||{})));case 4:case"end":return c.stop()}},M)})),$.apply(this,arguments)}},32266:function(Pe,re,t){"use strict";t.d(re,{zn:function(){return f},VX:function(){return M},dy:function(){return p},Ce:function(){return D}});var Y=t(39428),j=t(8870),r=t(3182),a=t(74310);function f(c,s){return k.apply(this,arguments)}function k(){return k=(0,r.Z)((0,Y.Z)().mark(function c(s,y){return(0,Y.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,a.WY)("/api/v1/degs",(0,j.Z)({method:"GET",params:(0,j.Z)({},s)},y||{})));case 1:case"end":return o.stop()}},c)})),k.apply(this,arguments)}function fe(c,s){return $.apply(this,arguments)}function $(){return $=_asyncToGenerator(_regeneratorRuntime().mark(function c(s,y){return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",request("/api/v1/gene-expr-data",_objectSpread({method:"GET",params:_objectSpread({},s)},y||{})));case 1:case"end":return o.stop()}},c)})),$.apply(this,arguments)}function M(c,s){return G.apply(this,arguments)}function G(){return G=(0,r.Z)((0,Y.Z)().mark(function c(s,y){return(0,Y.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,a.WY)("/api/v1/genes",(0,j.Z)({method:"GET",params:(0,j.Z)({},s)},y||{})));case 1:case"end":return o.stop()}},c)})),G.apply(this,arguments)}function p(c,s){return ee.apply(this,arguments)}function ee(){return ee=(0,r.Z)((0,Y.Z)().mark(function c(s,y){return(0,Y.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,a.WY)("/api/v1/pathways",(0,j.Z)({method:"GET",params:(0,j.Z)({},s)},y||{})));case 1:case"end":return o.stop()}},c)})),ee.apply(this,arguments)}function D(c,s){return de.apply(this,arguments)}function de(){return de=(0,r.Z)((0,Y.Z)().mark(function c(s,y){return(0,Y.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,a.WY)("/api/v1/similar-genes",(0,j.Z)({method:"GET",params:(0,j.Z)({},s)},y||{})));case 1:case"end":return o.stop()}},c)})),de.apply(this,arguments)}}}]);
